<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ’²å…‹ç‰ŒæŒ‘é¸èˆ‡å•ç­”éŠæˆ²</title>
  <style>
    body { font-family: sans-serif; background: #f0f0f0; }
    .deck, .selected { display: flex; flex-wrap: wrap; margin: 20px 0; }
    .card {
      width: 60px; height: 90px; margin: 5px; background: white; border: 1px solid #aaa;
      border-radius: 8px; display: flex; flex-direction: column; align-items: center;
      justify-content: center; font-size: 22px; cursor: pointer; user-select: none;
      box-shadow: 1px 1px 3px #ccc;
      transition: box-shadow 0.2s, transform 0.2s;
      position: relative;
    }
    .card.selected {
      border: 1px solid #2196f3;
      box-shadow: 1px 1px 3px #2196f355;
      transform: scale(1);
    }
    .card-index {
      position: absolute;
      top: 3px; left: 5px;
      background: #2196f3;
      color: #fff;
      font-size: 13px;
      padding: 0 6px;
      border-radius: 10px;
      pointer-events: none;
    }
    .card.dragging { opacity: 0.5; }
    .suit-heart, .suit-diamond { color: #e53935; }
    .suit-club, .suit-spade { color: #222; }
    .selected { min-height: 100px; border: 2px dashed #bbb; padding: 10px; }
    button { margin: 10px 0; padding: 8px 20px; font-size: 16px; }
    .qa-block { margin: 20px 0; padding: 16px; background: #fff; border-radius: 8px; box-shadow: 1px 1px 6px #ccc; }
    .record-area {
      display: flex;
      gap: 24px;
      margin: 20px 0;
    }
    .record-block {
      flex: 1;
      padding: 16px;
      background: #e3f2fd;
      border-radius: 8px;
      min-height: 240px;
      max-height: 300px;
      overflow-y: auto;
    }
    .record-block h4 { margin-top: 0; }
    .record-item { margin-bottom: 8px; }
    .note-block {
      flex: 1;
      padding: 16px;
      background: #fffde7;
      border-radius: 8px;
      min-height: 240px;
      max-height: 300px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    .note-block h4 { margin-top: 0; }
    .note-row-group {
      display: flex;
      flex-direction: row;
      gap: 8px;
      margin-bottom: 10px;
    }
    .note-row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-direction: column;
      justify-content: flex-start;
      margin-bottom: 0;
      width: 100%;
      box-sizing: border-box;
    }
    .note-label {
      width: 26px;
      text-align: center;
      font-weight: bold;
      font-size: 16px;
    }
    .note-select {
      font-size: 18px;
      padding: 2px 6px;
      border-radius: 5px;
      border: 1px solid #bbb;
      margin-right: 2px;
      width: 100%;
      box-sizing: border-box;
      justify-content: center;  /* æ°´å¹³ç½®ä¸­ */
      align-items: center;      /* å‚ç›´ç½®ä¸­ */
      text-align: center;       /* æ–‡å­—ç½®ä¸­ */
    }
    .note-cross-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 12px;
      justify-content: flex-start;
    }
    .cross-btn {
      width: 38px; height: 38px;
      border-radius: 12px;
      border: 1.5px solid #bbb;
      font-size: 18px;
      background: #fff;
      cursor: pointer;
      position: relative;
      transition: background 0.15s, color 0.15s;
      margin: 2px;
      display: flex;
      justify-content: center;  /* æ°´å¹³ç½®ä¸­ */
      align-items: center;      /* å‚ç›´ç½®ä¸­ */
      text-align: center;       /* æ–‡å­—ç½®ä¸­ */
    }
    .cross-btn.crossed {
      background: #bdbdbd;
      color: #fff;
      text-decoration: line-through;
      font-weight: bold;
    }
    .cross-btn:active { background: #90caf9; }
    .answer-input-row { margin-top: 10px; }
    .answer-input-row input { width: 180px; font-size: 16px; }
    .answer-input-row button { padding: 4px 12px; font-size: 15px; margin-left: 5px; }
    .toggle-btn {
      margin-left: 15px;
      padding: 8px 24px;
      font-size: 16px;
      border-radius: 16px;
      background: #2196f3;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    .toggle-btn.active {
      background: #1565c0;
      color: #fff;
    }
    .reset-btn {
      margin-left: 15px;
      padding: 8px 24px;
      font-size: 16px;
      border-radius: 16px;
      background: #FFD700;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    .ask-btn {
      margin-left: 15px;
      padding: 8px 24px;
      font-size: 16px;
      border-radius: 16px;
      background: #2E2E2E;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    .disabled-area {
      pointer-events: none;
      opacity: 1 !important;
      filter: none !important;
    }
  </style>
</head>
<body>
  <h2>æ’²å…‹ç‰Œè§£è¬éŠæˆ²</h2>
  <hr>
  <h3>1. é¸æ“‡è‡ªå·±çš„ç‰Œå‹</h3>
  <p> è«‹å¾ä¸‹æ–¹ç‰Œå †é¸å‡º8å¼µï¼Œæ‹–æ›³æ’åºå¾ŒæŒ‰ã€Œé–‹å§‹ã€ï¼ŒåŒèŠ±è‰²éœ€ç”±å°åˆ°å¤§(A=1, J=11, Q=12, K=13)ã€‚</p>
  <div id="deckArea">
    <div class="deck" id="deck"></div>
    <h4>å·²é¸æ“‡çš„ç‰Œï¼ˆå¯æ‹–æ›³èª¿æ•´é †åºï¼Œé»æ“Šå¯ç§»é™¤ï¼‰</h4>
    <div class="selected" id="selected" ondragover="event.preventDefault()"></div>
    <button id="resetBtn" class="reset-btn">é‡è¨­</button>
    <button id="startBtn" class="toggle-btn">é–‹å§‹</button>
  </div>
  <hr>
  <div class="note-block" id="noteBlock">
      <h4>æˆ‘çš„ç­†è¨˜</h4>
      <div class="note-row-group" id="noteRows"></div>
      <div class="note-cross-row" id="crossRow"></div>
  </div>
  <hr>
  <div class="qa-block">
    <h4>æå•å•é¡Œ</h4>
    <label for="question">é¸æ“‡å•é¡Œï¼š</label>
    <select id="question">
      <optgroup label="ğŸ’  SUMï¼ˆåŠ ç¸½ï¼‰">
        <option value="sum3">é¸æ“‡3å¼µå¡ç‰Œçš„ä½ç½®ï¼Œé€™äº›å¡ç‰Œçš„æ•¸å€¼ç¸½å’Œæ˜¯å¤šå°‘ï¼Ÿ</option>
        <option value="sumSuit">é¸æ“‡1ç¨®èŠ±è‰²ï¼Œé€™äº›å¡ç‰Œçš„æ•¸å€¼ç¸½å’Œæ˜¯å¤šå°‘ï¼Ÿ</option>
        <option value="sumLetter">è‹±æ–‡ç‰Œçš„æ•¸å€¼ç¸½å’Œæ˜¯å¤šå°‘ï¼Ÿ</option>
        <option value="sumNumber">æ•¸å­—ç‰Œçš„æ•¸å€¼ç¸½å’Œæ˜¯å¤šå°‘ï¼Ÿ</option>
      </optgroup>
      <optgroup label="ğŸ”· COUNTï¼ˆè¨ˆæ•¸ï¼‰">
        <option value="countLetter">è‹±æ–‡ç‰Œç¸½å…±æœ‰å¹¾å¼µï¼Ÿ</option>
        <option value="countNumber">æ•¸å­—ç‰Œç¸½å…±æœ‰å¹¾å¼µï¼Ÿ</option>
        <option value="countOne">é¸æ“‡1å€‹æ•¸å­—æˆ–1å€‹å­—æ¯ï¼Œè©²ç¨®é¡å¡ç‰Œæœ‰å¹¾å¼µï¼Ÿ</option>
      </optgroup>
      <optgroup label="ğŸŸ© POSITIONï¼ˆä½ç½®ï¼‰">
        <option value="posSuit">é¸æ“‡1ç¨®èŠ±è‰²ï¼Œæ­¤èŠ±è‰²å‡ºç¾åœ¨å“ªå¹¾å€‹ä½ç½®ï¼Ÿ</option>
        <option value="posSame">ç›¸åŒæ•¸å­—ã€ç›¸åŒè‹±æ–‡å­—æ¯çš„å¡ç‰Œå‡ºç¾åœ¨å“ªå¹¾å€‹ä½ç½®ï¼Ÿ</option>
        <option value="posSeq">é€£çºŒæ•¸å­—å‡ºç¾åœ¨å“ªå¹¾å€‹ä½ç½®ï¼ˆåŒ…æ‹¬é‡è¤‡æ•¸å­—ï¼‰ï¼Ÿ</option>
        <option value="posMaxMin">æœ€å¤§æ•¸å­—æˆ–æœ€å°æ•¸å­—çš„å¡ç‰Œåœ¨å“ªå¹¾å€‹ä½ç½®ï¼Ÿ</option>
      </optgroup>
    </select>
    <span id="params"></span>
    <button id="askBtn" class = "ask-btn">è©¢å•</button>
    <div class="answer-input-row" id="answerInputRow" style="display:none;">
      <label for="answerInput">è«‹è¼¸å…¥ç­”æ¡ˆï¼š</label>
      <input type="text" id="answerInput" inputmode="numeric" pattern="[0-9 ]*">
      <button id="submitAnswerBtn">ç¢ºå®š</button>
      <button id="cancelAnswerBtn">å–æ¶ˆ</button>
    </div>
  </div>
  <hr>
  <div class="record-area">
    <div class="record-block" id="recordBlock">
      <h4>å•ç­”ç´€éŒ„</h4>
    </div>
  </div>
  <script>
    // æ’²å…‹ç‰Œè³‡æ–™
    const suits = [
      {name: 'spade', symbol: 'â™ ', class: 'suit-spade'},
      {name: 'heart', symbol: 'â™¥', class: 'suit-heart'},
      {name: 'club', symbol: 'â™£', class: 'suit-club'},
      {name: 'diamond', symbol: 'â™¦', class: 'suit-diamond'}
    ];
    function numToFace(n) {
      if (n === 1) return 'A';
      if (n === 11) return 'J';
      if (n === 12) return 'Q';
      if (n === 13) return 'K';
      return n;
    }
    function faceToNum(f) {
      if (f === 'A') return 1;
      if (f === 'J') return 11;
      if (f === 'Q') return 12;
      if (f === 'K') return 13;
      return parseInt(f, 10);
    }
    // å›ºå®šé †åºä¸€å‰¯ç‰Œ
    function buildDeck() {
      let deck = [];
      for (let s = 0; s < suits.length; s++) {
        for (let n = 1; n <= 13; n++) {
          deck.push({
            suit: suits[s].name,
            suitSymbol: suits[s].symbol,
            suitClass: suits[s].class,
            value: n,
            type: n === 1 || n === 11 || n === 12 || n === 13,
            label: numToFace(n)
          });
        }
      }
      return deck;
    }
    let deck = [];
    let selected = [];
    let started = false;

    // æ¸²æŸ“ç‰Œå †
    function renderDeck() {
      const deckDiv = document.getElementById('deck');
      deckDiv.innerHTML = '';
      deck.forEach((card, idx) => {
        const c = document.createElement('div');
        c.className = `card ${card.suitClass}`;
        if (card.type) c.innerHTML = `<div>${card.suitSymbol}</div><div>${card.label}</div><div>${card.value}</div>`;
        else c.innerHTML = `<div>${card.suitSymbol}</div><div>${card.label}</div>`;
        c.onclick = () => {
          if (!started && selected.length < 8 && !selected.includes(card)) {
            selected.push(card);
            renderSelected();
            renderDeck();
          }
        };
        if (selected.includes(card)) c.classList.add('selected');
        if (started) c.style.pointerEvents = 'none';
        deckDiv.appendChild(c);
      });
    }
    // æ¸²æŸ“å·²é¸ç‰Œï¼ˆåŠ ä¸Šindexæ¨™ç¤ºï¼‰
    function renderSelected() {
      const selDiv = document.getElementById('selected');
      selDiv.innerHTML = '';
      selected.forEach((card, idx) => {
        const c = document.createElement('div');
        c.className = `card ${card.suitClass}`;
        c.draggable = !started;
        if (card.type) c.innerHTML = `<span class="card-index">${idx+1}</span><div>${card.suitSymbol}</div><div>${card.label}</div><div>${card.value}</div>`;
        else c.innerHTML = `<span class="card-index">${idx+1}</span><div>${card.suitSymbol}</div><div>${card.label}</div>`;
        if (!started) {
          c.ondragstart = e => {
            e.dataTransfer.setData('text/plain', idx);
            c.classList.add('dragging');
          };
          c.ondragend = e => c.classList.remove('dragging');
          c.ondragover = e => e.preventDefault();
          c.ondrop = e => {
            e.preventDefault();
            const from = parseInt(e.dataTransfer.getData('text/plain'));
            const to = idx;
            if (from !== to) {
              const temp = selected[from];
              selected.splice(from, 1);
              selected.splice(to, 0, temp);
              renderSelected();
            }
          };
          c.onclick = () => {
            selected.splice(idx, 1);
            renderSelected();
            renderDeck();
          };
        } else {
          c.ondragstart = null;
          c.ondragend = null;
          c.ondragover = null;
          c.ondrop = null;
          c.onclick = null;
        }
        selDiv.appendChild(c);
      });
    }
    function resetGame() {
      deck = buildDeck();
      selected = [];
      started = false;
      document.getElementById('startBtn').classList.remove('active');
      renderDeck();
      renderSelected();
      renderParams();
      renderNote();
      document.getElementById('deckArea').classList.remove('disabled-area');
    }
    document.getElementById('resetBtn').onclick = resetGame;

    // å•ç­”äº’å‹•
    const recordBlock = document.getElementById('recordBlock');
    const paramsDiv = document.getElementById('params');
    const questionSelect = document.getElementById('question');
    const askBtn = document.getElementById('askBtn');
    const answerInputRow = document.getElementById('answerInputRow');
    const answerInput = document.getElementById('answerInput');
    const submitAnswerBtn = document.getElementById('submitAnswerBtn');
    const cancelAnswerBtn = document.getElementById('cancelAnswerBtn');
    let paramInputs = [];
    let lastQuestionText = '';

    function renderParams() {
      paramsDiv.innerHTML = '';
      paramInputs = [];
      const q = questionSelect.value;
      const sampleCards = selected;
      if (q === 'sum3') {
        for (let i = 0; i < 3; i++) {
          const sel = document.createElement('select');
          for (let j = 1; j <= 8; j++) {
            const opt = document.createElement('option');
            opt.value = j-1;
            opt.textContent = j;
            sel.appendChild(opt);
          }
          paramsDiv.appendChild(document.createTextNode(`ä½ç½®${i+1} : `));
          paramsDiv.appendChild(sel);
          paramInputs.push(sel);
          paramsDiv.appendChild(document.createTextNode(` `));
        }
      } else if (q === 'sumSuit' || q === 'posSuit') {
        const sel = document.createElement('select');
        suits.forEach(s => {
          const opt = document.createElement('option');
          opt.value = s.name;
          opt.textContent = s.symbol;
          sel.appendChild(opt);
        });
        paramsDiv.appendChild(document.createTextNode('èŠ±è‰² : '));
        paramsDiv.appendChild(sel);
        paramInputs.push(sel);
      } else if (q === 'countOne') {
        const sel = document.createElement('select');
        for (let n = 1; n <= 13; n++) {
          let label = n;
          if (n === 1) label = 'A';
          if (n === 11) label = 'J';
          if (n === 12) label = 'Q';
          if (n === 13) label = 'K';
          sel.appendChild(new Option(label, n));
        }
        paramsDiv.appendChild(document.createTextNode('æ•¸å­—æˆ–å­—æ¯ : '));
        paramsDiv.appendChild(sel);
        paramInputs.push(sel);
<!--      } else if (q === 'posSeq') {-->
<!--        const input = document.createElement('input');-->
<!--        input.type = 'number';-->
<!--        input.min = 1;-->
<!--        input.max = 13;-->
<!--        input.placeholder = 'èµ·å§‹æ•¸å­—(1~13)';-->
<!--        paramsDiv.appendChild(input);-->
<!--        paramInputs.push(input);-->
<!--      } else if (q === 'posMaxMin') {-->
<!--        const sel = document.createElement('select');-->
<!--        sel.appendChild(new Option('æœ€å¤§', 'max'));-->
<!--        sel.appendChild(new Option('æœ€å°', 'min'));-->
<!--        paramsDiv.appendChild(sel);-->
<!--        paramInputs.push(sel);-->
      }
    }
    questionSelect.onchange = renderParams;

    // å•é¡Œæ–‡å­—ç”¢ç”Ÿï¼ˆä¸è¨ˆç®—ç­”æ¡ˆï¼‰
    function getQuestionText() {
      const q = questionSelect.value;
      const sampleCards = selected;
      let questionText = questionSelect.options[questionSelect.selectedIndex].text;
      if (q === 'sum3') {
        if (sampleCards.length < 3) {
          alert('è«‹å…ˆé¸æ“‡è‡³å°‘3å¼µå¡ç‰Œï¼');
          return null;
        }
        const idxs = paramInputs.map(sel => Number(sel.value));
        questionText += `ï¼ˆç¬¬${idxs.map(i=>i+1).join('ã€')}å¼µï¼‰`;
      } else if (q === 'sumSuit' || q === 'posSuit') {
        const suit = paramInputs[0].value;
        const s = suits.find(s=>s.name===suit);
        questionText += `ï¼ˆ${s.symbol}ï¼‰`;
      } else if (q === 'countOne') {
        const n = Number(paramInputs[0].value);
        let label = n;
        if (n === 1) label = 'A';
        if (n === 11) label = 'J';
        if (n === 12) label = 'Q';
        if (n === 13) label = 'K';
        questionText += `ï¼ˆ${label}ï¼‰`;
<!--      } else if (q === 'posSeq') {-->
<!--        const start = Number(paramInputs[0].value);-->
<!--        if (!start || start < 1 || start > 13) {-->
<!--          alert('è«‹è¼¸å…¥1~13çš„èµ·å§‹æ•¸å­—');-->
<!--          return null;-->
<!--        }-->
<!--        questionText += `ï¼ˆèµ·å§‹æ•¸å­—${start}ï¼‰`;-->
<!--      } else if (q === 'posMaxMin') {-->
<!--        const type = paramInputs[0].value;-->
<!--        questionText += type === 'max' ? 'ï¼ˆæœ€å¤§ï¼‰' : 'ï¼ˆæœ€å°ï¼‰';-->
      }
      return questionText;
    }

    // å•é¡Œè©¢å•æµç¨‹
    askBtn.onclick = function() {
      if (selected.length === 0) {
        alert('è«‹å…ˆé¸æ“‡è‡³å°‘ä¸€å¼µå¡ç‰Œï¼');
        return;
      }
      const questionText = getQuestionText();
      if (!questionText) return;
      lastQuestionText = questionText;
      answerInput.value = '';
      answerInputRow.style.display = '';
      answerInput.focus();
    };
    submitAnswerBtn.onclick = function() {
      const answer = answerInput.value.trim();
      if (!answer) {
        alert('è«‹è¼¸å…¥ç­”æ¡ˆ');
        return;
      }
      const div = document.createElement('div');
      div.className = 'record-item';
      div.innerHTML = `<b>Q${recordBlock.querySelectorAll('.record-item').length+1}.</b> ${lastQuestionText}<br><span style="color:#1565c0">${answer}</span>`;
      recordBlock.appendChild(div);
      recordBlock.scrollTop = recordBlock.scrollHeight;
      answerInputRow.style.display = 'none';
      answerInput.value = '';
    };
    cancelAnswerBtn.onclick = function() {
      answerInputRow.style.display = 'none';
      answerInput.value = '';
    };

    // ç­†è¨˜æ¬„åŠŸèƒ½
    const noteRowsDiv = document.getElementById('noteRows');
    const crossRowDiv = document.getElementById('crossRow');
    let noteData = [];
    let crossData = [];
    function renderNote() {
      if (!noteData.length) {
        noteData = [];
        for (let i = 0; i < 8; i++) {
          noteData.push({suit: '', value: ''});
        }
      }
      if (!crossData.length) {
        crossData = [];
        for (let i = 1; i <= 13; i++) {
          crossData.push(false);
        }
      }
      // 8å€‹ä½ç½® row æ©«åˆ—æ’åˆ—ï¼šindex | æ•¸å­— | èŠ±è‰²
      noteRowsDiv.innerHTML = '';
      for (let i = 0; i < 8; i++) {
        const row = document.createElement('div');
        row.className = 'note-row';
        // index
        row.innerHTML = `<span class="note-label">${i+1}</span>`;
        // æ•¸å­—é¸å–®
        const numSel = document.createElement('select');
        numSel.className = 'note-select';
        numSel.innerHTML = `<option value="">?</option>`;
        for (let n = 1; n <= 13; n++) {
          let label = numToFace(n);
          const opt = document.createElement('option');
          opt.value = n;
          opt.textContent = label;
          if (noteData[i].value == n) opt.selected = true;
          numSel.appendChild(opt);
        }
        numSel.onchange = function() {
          noteData[i].value = this.value;
        };
        row.appendChild(numSel);
        // èŠ±è‰²é¸å–®
        const suitSel = document.createElement('select');
        suitSel.className = 'note-select';
        suitSel.innerHTML = `<option value="">?</option>`;
        suits.forEach(s => {
          const opt = document.createElement('option');
          opt.value = s.name;
          opt.textContent = s.symbol;
          if (noteData[i].suit === s.name) opt.selected = true;
          suitSel.appendChild(opt);
        });
        suitSel.onchange = function() {
          noteData[i].suit = this.value;
        };
        row.appendChild(suitSel);
        noteRowsDiv.appendChild(row);
      }
      // åŠƒæ‰åˆ—
      crossRowDiv.innerHTML = '';
      for (let n = 1; n <= 13; n++) {
        let label = numToFace(n);
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'cross-btn' + (crossData[n-1] ? ' crossed' : '');
        btn.textContent = label;
        btn.onclick = function() {
          crossData[n-1] = !crossData[n-1];
          renderNote();
        };
        crossRowDiv.appendChild(btn);
      }
    }

    // é–‹å§‹æŒ‰éˆ•
    document.getElementById('startBtn').onclick = function() {
      if (started) {
        // å›åˆ°å¯ç·¨è¼¯ç‹€æ…‹
        started = false;
        this.classList.remove('active');
<!--        document.getElementById('deckArea').classList.remove('disabled-area');-->
        renderDeck();
        renderSelected();
        return;
      }
      if (selected.length !== 8) {
        alert('è«‹å…ˆé¸æ»¿8å¼µç‰Œæ‰èƒ½é–‹å§‹ï¼');
        return;
      }
      // è‡ªå‹•æª¢æŸ¥
      const suitGroups = {};
      selected.forEach((card, idx) => {
        if (!suitGroups[card.suit]) suitGroups[card.suit] = [];
        suitGroups[card.suit].push({value: card.value, pos: idx});
      });
      for (const suit in suitGroups) {
        const arr = suitGroups[suit];
        for (let i = 1; i < arr.length; i++) {
          if (arr[i].pos < arr[i-1].pos) {
            alert(`éŒ¯èª¤: ${suits.find(s=>s.name===suit).symbol} èŠ±è‰²çš„ç‰Œé †åºéŒ¯èª¤!`);
            return;
          }
          if (arr[i].value < arr[i-1].value) {
            alert(`éŒ¯èª¤: ${suits.find(s=>s.name===suit).symbol} èŠ±è‰²çš„ç‰Œæ•¸å­—éœ€ç”±å°åˆ°å¤§!`);
            return;
          }
        }
      }
      started = true;
      alert('æ’åºæ­£ç¢ºï¼Œè«‹é–‹å§‹éŠæˆ²ã€‚');
      this.classList.add('active');
<!--      document.getElementById('deckArea').classList.add('disabled-area');-->
      renderDeck();
      renderSelected();
    };

    // åˆå§‹åŒ–
    resetGame();
  </script>
</body>
</html>
